# https://github.com/baxpr/feat-task-fmri
---
procyamlversion: 3.0.0-dev.0
containers:
  - name: fsl
    path: fsl-base_ NNNN
    source: docker://baxterprogers/fsl-base NNNN
requirements:
  walltime: 0-8
  memory: 8G
jobtemplate: job_template_v3.txt


inputs:

  xnat:

    filters:
      - type: match
        inputs: scan_fmri,assr_fmriprep/scan_fmri
        
    scans:
      - name: scan_fmri
        types: wm*
        resources:
          - {resource: NIFTI, fmatch: '*.nii.gz', fdest: fmri1.nii.gz}
          - {resource: EPRIME, fmatch: '*.txt', fdest: eprime.txt}
        needs_qc: True

    assessors:
      - name: assr_fmriprep
        proctypes: fmriprep_v24
        resources:
          - {resource: fmriprepBIDS, ftype: DIR, fdest: fmriprepBIDS}


outputs:
  - {path: feat-GF-WM/GF-WM.feat, type: DIR, resource: FEAT}
  - {path: HTML, type: DIR, resource: HTML}
  - {path: feat-task-fmri-1.0.0, type: DIR, resource: SCRIPTS}
  - {path: eprime.csv, type: FILE, resource: EPRIME_CSV}


command: 
  type: singularity_exec
  container: fsl
  args: >-
    bash -c '
    cd /OUTPUTS &&
    curl -o scripts.tar.gz -L https://github.com/baxpr/feat-task-fmri/archive/refs/tags/v1.0.0.tar.gz &&
    tar -zxf scripts.tar.gz &&
    export PATH=/OUTPUTS/feat-task-fmri-1.0.0/src:\$PATH &&
    pipeline-GF-WM.sh 
      --eprime_txt /INPUTS/eprime.txt
      --fmriprep_dir /INPUTS/fmriprepBIDS/fmriprepBIDS
      --out_dir /OUTPUTS
    '
