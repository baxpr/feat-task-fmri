# https://github.com/baxpr/feat-task-fmri
---
procyamlversion: 3.0.0-dev.0
containers:
  - name: fsl
    path: fsl-base_v6.0.7.18.sif
    source: docker://baxterprogers/fsl-base:v6.0.7.18
requirements:
  walltime: 0-4
  memory: 8G
jobtemplate: job_template_v3.txt


inputs:

  xnat:

    filters:
      - type: match
        inputs: scan_fmri,assr_fmriprep/scan_fmri
        
    scans:
      - name: scan_fmri
        types: oddball1*
        resources:
          - {resource: EPRIME_TXT, fmatch: '*.txt', fdest: eprime.txt}
        skip_unusable: True

    assessors:
      - name: assr_fmriprep
        proctypes: fmriprep_v24
        resources:
          - {resource: fmriprepBIDS, ftype: DIR, fdest: fmriprepBIDS}


outputs:
  - {path: feat-GF-oddball/GF-oddball.feat, type: DIR, resource: FEAT}
  - {path: HTML, type: DIR, resource: HTML}
  - {path: feat-task-fmri/src, type: DIR, resource: SCRIPTS}
  - {path: eprime.csv, type: FILE, resource: EPRIME_CSV}


command:
  type: singularity_exec
  container: fsl
  args: >-
    bash -c '
    cd /OUTPUTS &&
    wget -O feat-task-fmri.tar.gz https://github.com/baxpr/feat-task-fmri/archive/refs/tags/v1.1.0.tar.gz &&
    tar -zxf feat-task-fmri.tar.gz &&
    mv feat-task-fmri-* feat-task-fmri &&
    export PATH=/OUTPUTS/feat-task-fmri/src:\$PATH &&
    pipeline-GF-oddball-run-firstlevel.sh
      --eprime_txt /INPUTS/eprime.txt
      --fmriprep_dir /INPUTS/fmriprepBIDS/fmriprepBIDS
      --out_dir /OUTPUTS
    '
